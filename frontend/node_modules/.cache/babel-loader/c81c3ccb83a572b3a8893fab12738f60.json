{"ast":null,"code":"import _regeneratorRuntime from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/niruhan/MSc/source_code/lang-exchange-lk/frontend/src/pages/Auth/SignIn.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  font-size: \", \";\\n  margin-top: \", \";\\n  color: \", \";\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  position: absolute;\\n  top: 1px;\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  align-items: space-between;\\n  font-size: \", \";\\n  margin-top: \", \";\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router-dom';\nimport { Mutation } from 'react-apollo';\nimport styled from 'styled-components';\nimport { A } from 'components/Text';\nimport { Spacing } from 'components/Layout';\nimport { Error } from 'components/Text';\nimport { InputText, Button } from 'components/Form';\nimport { SIGN_IN } from 'graphql/user';\nimport * as Routes from 'routes';\nvar Root = styled.div(_templateObject(), function (p) {\n  return p.theme.font.size.xxs;\n}, function (p) {\n  return p.theme.spacing.sm;\n});\nvar InputContainer = styled(Spacing)(_templateObject2());\nvar ErrorMessage = styled.div(_templateObject3());\nvar ForgotPassword = styled.div(_templateObject4(), function (p) {\n  return p.theme.font.size.xxs;\n}, function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.colors.white;\n});\n/**\n * Sign In page\n */\n\nvar SignIn = function SignIn(_ref) {\n  var history = _ref.history,\n      location = _ref.location,\n      refetch = _ref.refetch;\n\n  var _useState = useState({\n    emailOrUsername: '',\n    password: ''\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      values = _useState2[0],\n      setValues = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      error = _useState4[0],\n      setError = _useState4[1];\n\n  useEffect(function () {\n    setError('');\n  }, [location.pathname]);\n\n  var handleChange = function handleChange(e) {\n    var _e$target = e.target,\n        name = _e$target.name,\n        value = _e$target.value;\n    setValues(_objectSpread({}, values, _defineProperty({}, name, value)));\n  };\n\n  var handleSubmit = function handleSubmit(e, signin) {\n    e.preventDefault();\n\n    if (!emailOrUsername || !password) {\n      setError('All fields are required');\n      return;\n    }\n\n    setError('');\n    signin().then(\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(_ref2) {\n        var data;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = _ref2.data;\n                localStorage.setItem('token', data.signin.token);\n                _context.next = 4;\n                return refetch();\n\n              case 4:\n                history.push(Routes.HOME);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n  };\n\n  var renderErrors = function renderErrors(apiError) {\n    var errorMessage;\n\n    if (error) {\n      errorMessage = error;\n    } else if (apiError) {\n      errorMessage = apiError.graphQLErrors[0].message;\n    }\n\n    if (errorMessage) {\n      return React.createElement(ErrorMessage, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }, React.createElement(Error, {\n        size: \"xxs\",\n        color: \"white\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }, errorMessage));\n    }\n\n    return null;\n  };\n\n  var emailOrUsername = values.emailOrUsername,\n      password = values.password;\n  return React.createElement(Mutation, {\n    mutation: SIGN_IN,\n    variables: {\n      input: {\n        emailOrUsername: emailOrUsername,\n        password: password\n      }\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, function (signin, _ref4) {\n    var loading = _ref4.loading,\n        apiError = _ref4.error;\n    return React.createElement(\"form\", {\n      onSubmit: function onSubmit(e) {\n        return handleSubmit(e, signin);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101\n      },\n      __self: this\n    }, React.createElement(Root, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }, React.createElement(InputContainer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103\n      },\n      __self: this\n    }, renderErrors(apiError), React.createElement(InputText, {\n      autoFocus: true,\n      type: \"text\",\n      name: \"emailOrUsername\",\n      values: emailOrUsername,\n      onChange: handleChange,\n      placeholder: \"Email or Username\",\n      borderColor: \"white\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    })), React.createElement(InputContainer, {\n      left: \"xs\",\n      right: \"xs\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }, React.createElement(InputText, {\n      type: \"password\",\n      name: \"password\",\n      values: password,\n      onChange: handleChange,\n      placeholder: \"Password\",\n      borderColor: \"white\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }), React.createElement(A, {\n      to: Routes.FORGOT_PASSWORD,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, React.createElement(ForgotPassword, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    }, \"Forgot password?\"))), React.createElement(Button, {\n      disabled: loading,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, \"Log in\")));\n  });\n};\n\nSignIn.propTypes = {\n  history: PropTypes.object.isRequired,\n  refetch: PropTypes.func.isRequired\n};\nexport default withRouter(SignIn);","map":{"version":3,"sources":["/Users/niruhan/MSc/source_code/lang-exchange-lk/frontend/src/pages/Auth/SignIn.js"],"names":["React","useState","useEffect","PropTypes","withRouter","Mutation","styled","A","Spacing","Error","InputText","Button","SIGN_IN","Routes","Root","div","p","theme","font","size","xxs","spacing","sm","InputContainer","ErrorMessage","ForgotPassword","colors","white","SignIn","history","location","refetch","emailOrUsername","password","values","setValues","error","setError","pathname","handleChange","e","target","name","value","handleSubmit","signin","preventDefault","then","data","localStorage","setItem","token","push","HOME","renderErrors","apiError","errorMessage","graphQLErrors","message","input","loading","FORGOT_PASSWORD","propTypes","object","isRequired","func"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router-dom';\nimport { Mutation } from 'react-apollo';\nimport styled from 'styled-components';\n\nimport { A } from 'components/Text';\nimport { Spacing } from 'components/Layout';\nimport { Error } from 'components/Text';\nimport { InputText, Button } from 'components/Form';\n\nimport { SIGN_IN } from 'graphql/user';\n\nimport * as Routes from 'routes';\n\nconst Root = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: space-between;\n  font-size: ${p => p.theme.font.size.xxs};\n  margin-top: ${p => p.theme.spacing.sm};\n`;\n\nconst InputContainer = styled(Spacing)`\n  width: 100%;\n`;\n\nconst ErrorMessage = styled.div`\n  position: absolute;\n  top: 1px;\n`;\n\nconst ForgotPassword = styled.div`\n  font-size: ${p => p.theme.font.size.xxs};\n  margin-top: ${p => p.theme.spacing.xxs};\n  color: ${p => p.theme.colors.white};\n`;\n\n/**\n * Sign In page\n */\nconst SignIn = ({ history, location, refetch }) => {\n  const [values, setValues] = useState({ emailOrUsername: '', password: '' });\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    setError('');\n  }, [location.pathname]);\n\n  const handleChange = e => {\n    const { name, value } = e.target;\n    setValues({ ...values, [name]: value });\n  };\n\n  const handleSubmit = (e, signin) => {\n    e.preventDefault();\n\n    if (!emailOrUsername || !password) {\n      setError('All fields are required');\n      return;\n    }\n\n    setError('');\n    signin().then(async ({ data }) => {\n      localStorage.setItem('token', data.signin.token);\n      await refetch();\n      history.push(Routes.HOME);\n    });\n  };\n\n  const renderErrors = apiError => {\n    let errorMessage;\n\n    if (error) {\n      errorMessage = error;\n    } else if (apiError) {\n      errorMessage = apiError.graphQLErrors[0].message;\n    }\n\n    if (errorMessage) {\n      return (\n        <ErrorMessage>\n          <Error size=\"xxs\" color=\"white\">\n            {errorMessage}\n          </Error>\n        </ErrorMessage>\n      );\n    }\n\n    return null;\n  };\n\n  const { emailOrUsername, password } = values;\n\n  return (\n    <Mutation\n      mutation={SIGN_IN}\n      variables={{ input: { emailOrUsername, password } }}\n    >\n      {(signin, { loading, error: apiError }) => (\n        <form onSubmit={e => handleSubmit(e, signin)}>\n          <Root>\n            <InputContainer>\n              {renderErrors(apiError)}\n\n              <InputText\n                autoFocus\n                type=\"text\"\n                name=\"emailOrUsername\"\n                values={emailOrUsername}\n                onChange={handleChange}\n                placeholder=\"Email or Username\"\n                borderColor=\"white\"\n              />\n            </InputContainer>\n\n            <InputContainer left=\"xs\" right=\"xs\">\n              <InputText\n                type=\"password\"\n                name=\"password\"\n                values={password}\n                onChange={handleChange}\n                placeholder=\"Password\"\n                borderColor=\"white\"\n              />\n              <A to={Routes.FORGOT_PASSWORD}>\n                <ForgotPassword>Forgot password?</ForgotPassword>\n              </A>\n            </InputContainer>\n\n            <Button disabled={loading}>Log in</Button>\n          </Root>\n        </form>\n      )}\n    </Mutation>\n  );\n};\n\nSignIn.propTypes = {\n  history: PropTypes.object.isRequired,\n  refetch: PropTypes.func.isRequired,\n};\n\nexport default withRouter(SignIn);\n"]},"metadata":{},"sourceType":"module"}