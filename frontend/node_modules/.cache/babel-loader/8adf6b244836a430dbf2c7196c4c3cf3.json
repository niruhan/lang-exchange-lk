{"ast":null,"code":"import _regeneratorRuntime from \"/Users/niruhan/MSc/source_code/new/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/niruhan/MSc/source_code/new/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/niruhan/MSc/source_code/new/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/Users/niruhan/MSc/source_code/new/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/niruhan/MSc/source_code/new/lang-exchange-lk/frontend/src/components/App/Notification.js\";\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100%;\\n  object-fit: cover;\\n  display: block;\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 40px;\\n  height: 40px;\\n  overflow: hidden;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  align-items: center;\\n  justify-content: space-between;\\n  flex: 1;\\n  margin-left: \", \";\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  font-weight: \", \";\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  align-items: center;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: space-between;\\n  align-items: center;\\n  padding: \", \";\\n  border-bottom: 1px solid \", \";\\n  font-size: \", \";\\n  background-color: \", \";\\n\\n  &:last-child {\\n    border-bottom: 0;\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { generatePath } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { withApollo } from 'react-apollo';\nimport { A } from 'components/Text';\nimport { Spacing } from 'components/Layout';\nimport Avatar from 'components/Avatar';\nimport { useClickOutside } from 'hooks/useClickOutside';\nimport { GET_AUTH_USER } from 'graphql/user';\nimport { UPDATE_NOTIFICATION_SEEN } from 'graphql/notification';\nimport { useStore } from 'store';\nimport * as Routes from 'routes';\nvar NotificationItem = styled.div(_templateObject(), function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.theme.colors.border.main;\n}, function (p) {\n  return p.theme.font.size.xxs;\n}, function (p) {\n  return p.theme.colors.white;\n});\nvar LeftSide = styled.div(_templateObject2());\nvar Name = styled.div(_templateObject3(), function (p) {\n  return p.theme.font.weight.bold;\n});\nvar Action = styled.div(_templateObject4(), function (p) {\n  return p.theme.spacing.xs;\n});\nvar PostImage = styled.div(_templateObject5());\nvar Image = styled.img(_templateObject6());\n/**\n * Renders user notifications\n */\n\nvar Notification = function Notification(_ref) {\n  var notification = _ref.notification,\n      close = _ref.close,\n      client = _ref.client;\n\n  var _useStore = useStore(),\n      _useStore2 = _slicedToArray(_useStore, 1),\n      auth = _useStore2[0].auth;\n\n  var ref = React.useRef(null);\n  useClickOutside(ref, close);\n  useEffect(function () {\n    var updateNotificationSeen =\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return client.mutate({\n                  mutation: UPDATE_NOTIFICATION_SEEN,\n                  variables: {\n                    input: {\n                      userId: auth.user.id\n                    }\n                  },\n                  refetchQueries: function refetchQueries() {\n                    return [{\n                      query: GET_AUTH_USER\n                    }];\n                  }\n                });\n\n              case 3:\n                _context.next = 7;\n                break;\n\n              case 5:\n                _context.prev = 5;\n                _context.t0 = _context[\"catch\"](0);\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 5]]);\n      }));\n\n      return function updateNotificationSeen() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    updateNotificationSeen();\n  }, [auth.user.id, auth.user.newNotifications.length, client]);\n\n  if (!notification.follow && !notification.like && !notification.comment) {\n    return null;\n  }\n\n  return React.createElement(NotificationItem, {\n    ref: ref,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  }, React.createElement(A, {\n    to: generatePath(Routes.USER_PROFILE, {\n      username: notification.author.username\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101\n    },\n    __self: this\n  }, React.createElement(LeftSide, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, React.createElement(Avatar, {\n    image: notification.author.image,\n    size: 34,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }), React.createElement(Spacing, {\n    left: \"xs\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }), React.createElement(Name, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, notification.author.fullName))), notification.follow && React.createElement(Action, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, \"started following you\"), notification.like && React.createElement(Action, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, \"likes your photo\", React.createElement(A, {\n    to: generatePath(Routes.POST, {\n      id: notification.like.post.id\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, React.createElement(PostImage, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(Image, {\n    src: notification.like.post.image,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  })))), notification.comment && React.createElement(Action, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, \"commented on your photo\", React.createElement(A, {\n    to: generatePath(Routes.POST, {\n      id: notification.comment.post.id\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, React.createElement(PostImage, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  }, React.createElement(Image, {\n    src: notification.comment.post.image,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  })))));\n};\n\nNotification.propTypes = {\n  client: PropTypes.object.isRequired,\n  close: PropTypes.func\n};\nexport default withApollo(Notification);","map":{"version":3,"sources":["/Users/niruhan/MSc/source_code/new/lang-exchange-lk/frontend/src/components/App/Notification.js"],"names":["React","useEffect","PropTypes","generatePath","styled","withApollo","A","Spacing","Avatar","useClickOutside","GET_AUTH_USER","UPDATE_NOTIFICATION_SEEN","useStore","Routes","NotificationItem","div","p","theme","spacing","xs","colors","border","main","font","size","xxs","white","LeftSide","Name","weight","bold","Action","PostImage","Image","img","Notification","notification","close","client","auth","ref","useRef","updateNotificationSeen","mutate","mutation","variables","input","userId","user","id","refetchQueries","query","newNotifications","length","follow","like","comment","USER_PROFILE","username","author","image","fullName","POST","post","propTypes","object","isRequired","func"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { generatePath } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { withApollo } from 'react-apollo';\n\nimport { A } from 'components/Text';\nimport { Spacing } from 'components/Layout';\nimport Avatar from 'components/Avatar';\n\nimport { useClickOutside } from 'hooks/useClickOutside';\n\nimport { GET_AUTH_USER } from 'graphql/user';\nimport { UPDATE_NOTIFICATION_SEEN } from 'graphql/notification';\n\nimport { useStore } from 'store';\n\nimport * as Routes from 'routes';\n\nconst NotificationItem = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  padding: ${p => p.theme.spacing.xs};\n  border-bottom: 1px solid ${p => p.theme.colors.border.main};\n  font-size: ${p => p.theme.font.size.xxs};\n  background-color: ${p => p.theme.colors.white};\n\n  &:last-child {\n    border-bottom: 0;\n  }\n`;\n\nconst LeftSide = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n`;\n\nconst Name = styled.div`\n  font-weight: ${p => p.theme.font.weight.bold};\n`;\n\nconst Action = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  flex: 1;\n  margin-left: ${p => p.theme.spacing.xs};\n`;\n\nconst PostImage = styled.div`\n  width: 40px;\n  height: 40px;\n  overflow: hidden;\n`;\n\nconst Image = styled.img`\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  display: block;\n`;\n\n/**\n * Renders user notifications\n */\nconst Notification = ({ notification, close, client }) => {\n  const [{ auth }] = useStore();\n\n  const ref = React.useRef(null);\n\n  useClickOutside(ref, close);\n\n  useEffect(() => {\n    const updateNotificationSeen = async () => {\n      try {\n        await client.mutate({\n          mutation: UPDATE_NOTIFICATION_SEEN,\n          variables: {\n            input: {\n              userId: auth.user.id,\n            },\n          },\n          refetchQueries: () => [{ query: GET_AUTH_USER }],\n        });\n      } catch (err) {}\n    };\n\n    updateNotificationSeen();\n  }, [auth.user.id, auth.user.newNotifications.length, client]);\n\n  if (!notification.follow && !notification.like && !notification.comment) {\n    return null;\n  }\n\n  return (\n    <NotificationItem ref={ref}>\n      <A\n        to={generatePath(Routes.USER_PROFILE, {\n          username: notification.author.username,\n        })}\n      >\n        <LeftSide>\n          <Avatar image={notification.author.image} size={34} />\n\n          <Spacing left=\"xs\" />\n\n          <Name>{notification.author.fullName}</Name>\n        </LeftSide>\n      </A>\n\n      {notification.follow && <Action>started following you</Action>}\n\n      {notification.like && (\n        <Action>\n          likes your photo\n          <A to={generatePath(Routes.POST, { id: notification.like.post.id })}>\n            <PostImage>\n              <Image src={notification.like.post.image} />\n            </PostImage>\n          </A>\n        </Action>\n      )}\n\n      {notification.comment && (\n        <Action>\n          commented on your photo\n          <A\n            to={generatePath(Routes.POST, { id: notification.comment.post.id })}\n          >\n            <PostImage>\n              <Image src={notification.comment.post.image} />\n            </PostImage>\n          </A>\n        </Action>\n      )}\n    </NotificationItem>\n  );\n};\n\nNotification.propTypes = {\n  client: PropTypes.object.isRequired,\n  close: PropTypes.func,\n};\n\nexport default withApollo(Notification);\n"]},"metadata":{},"sourceType":"module"}