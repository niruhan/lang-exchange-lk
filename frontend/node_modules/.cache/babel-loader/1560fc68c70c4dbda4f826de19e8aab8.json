{"ast":null,"code":"import _toConsumableArray from \"/Users/niruhan/MSc/source_code/new/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _taggedTemplateLiteral from \"/Users/niruhan/MSc/source_code/new/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/niruhan/MSc/source_code/new/lang-exchange-lk/frontend/src/pages/Messages/MessagesUsers.js\";\n\nfunction _templateObject12() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-top: \", \";\\n  font-size: \", \";\\n  color: \", \";\\n  text-overflow: ellipsis;\\n\"]);\n\n  _templateObject12 = function _templateObject12() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject11() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 8px;\\n  height: 8px;\\n  background-color: \", \";\\n  border-radius: 50%;\\n\"]);\n\n  _templateObject11 = function _templateObject11() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject10() {\n  var data = _taggedTemplateLiteral([\"\\n  text-overflow: ellipsis;\\n  width: 100%;\\n\"]);\n\n  _templateObject10 = function _templateObject10() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  font-size: \", \";\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: space-between;\\n  align-items: center;\\n\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  display: none;\\n  padding: 0 \", \";\\n\\n  @media (min-width: \", \") {\\n    display: block;\\n  }\\n\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  padding: \", \" \", \";\\n  margin-bottom: \", \";\\n  border-radius: \", \";\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: flex-start;\\n  align-items: center;\\n  text-decoration: none;\\n  color: \", \";\\n\\n  @media (max-width: \", \") {\\n    \", \";\\n  }\\n\\n  &.selected {\\n    background-color: \", \";\\n  }\\n\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-top: \", \";\\n  padding: 0 \", \";\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  display: none;\\n  border-bottom: 1px solid \", \";\\n\\n  @media (min-width: \", \") {\\n    display: block;\\n  }\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 40px;\\n  height: 40px;\\n  background-color: \", \";\\n  border-radius: 50%;\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: center;\\n  align-items: center;\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  display: none;\\n  color: \", \";\\n  margin: 0;\\n\\n  @media (min-width: \", \") {\\n    display: block;\\n  }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  border-bottom: 1px solid \", \";\\n  height: 60px;\\n  padding: 0 \", \";\\n  display: flex;\\n  flex-direction: row;\\n  align-items: center;\\n  justify-content: center;\\n\\n  @media (min-width: \", \") {\\n    justify-content: space-between;\\n  }\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 80px;\\n  height: 100%;\\n  border-right: 1px solid \", \";\\n\\n  @media (min-width: \", \") {\\n    width: 330px;\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport { NavLink, generatePath, withRouter } from 'react-router-dom';\nimport { useQuery } from '@apollo/react-hooks';\nimport { GET_CONVERSATIONS } from 'graphql/user';\nimport { GET_NEW_CONVERSATIONS_SUBSCRIPTION } from 'graphql/messages';\nimport Search from 'components/Search';\nimport { PencilIcon } from 'components/icons';\nimport { LoadingDots } from 'components/Loading';\nimport Avatar from 'components/Avatar';\nimport * as Routes from 'routes';\nvar Root = styled.div(_templateObject(), function (p) {\n  return p.theme.colors.border.main;\n}, function (p) {\n  return p.theme.screen.lg;\n});\nvar HeadingContainer = styled.div(_templateObject2(), function (p) {\n  return p.theme.colors.border.main;\n}, function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.theme.screen.lg;\n});\nvar Heading = styled.h3(_templateObject3(), function (p) {\n  return p.theme.colors.text.primary;\n}, function (p) {\n  return p.theme.screen.lg;\n});\nvar NewMessage = styled(NavLink)(_templateObject4(), function (p) {\n  return p.theme.colors.grey[200];\n});\nvar SearchContainer = styled.div(_templateObject5(), function (p) {\n  return p.theme.colors.border.main;\n}, function (p) {\n  return p.theme.screen.lg;\n});\nvar UserContainer = styled.div(_templateObject6(), function (p) {\n  return p.theme.spacing.sm;\n}, function (p) {\n  return p.theme.spacing.xxs;\n});\nvar User = styled(NavLink)(_templateObject7(), function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.radius.md;\n}, function (p) {\n  return p.theme.colors.text.primary;\n}, function (p) {\n  return p.theme.screen.lg;\n}, function (p) {\n  return !p.seen && \"\\n        background-color: \".concat(p.theme.colors.primary.light, \";\\n      \");\n}, function (p) {\n  return p.theme.colors.grey[100];\n});\nvar Info = styled.div(_templateObject8(), function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.theme.screen.lg;\n});\nvar FullNameUnSeen = styled.div(_templateObject9(), function (p) {\n  return p.theme.font.size.sm;\n});\nvar FullName = styled.div(_templateObject10());\nvar UnSeen = styled.div(_templateObject11(), function (p) {\n  return p.theme.colors.primary.light;\n});\nvar LastMessage = styled.div(_templateObject12(), function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.font.size.xxs;\n}, function (p) {\n  return p.theme.colors.grey[500];\n});\n/**\n * Component that renders users, with whom auth user had a chat\n */\n\nvar MessagesUsers = function MessagesUsers(_ref) {\n  var location = _ref.location,\n      authUser = _ref.authUser;\n\n  var _useQuery = useQuery(GET_CONVERSATIONS, {\n    variables: {\n      authUserId: authUser.id\n    }\n  }),\n      subscribeToMore = _useQuery.subscribeToMore,\n      data = _useQuery.data,\n      loading = _useQuery.loading;\n\n  useEffect(function () {\n    var unsubscribe = subscribeToMore({\n      document: GET_NEW_CONVERSATIONS_SUBSCRIPTION,\n      updateQuery: function updateQuery(prev, _ref2) {\n        var subscriptionData = _ref2.subscriptionData;\n        if (!subscriptionData.data) return prev;\n        var newConversation = subscriptionData.data.newConversation;\n        var oldConversations = prev.getConversations;\n\n        if (oldConversations.some(function (u) {\n          return u.id === newConversation.id;\n        })) {\n          return prev;\n        } // Merge conversations\n\n\n        var conversations = newConversation;\n        delete conversations['receiverId'];\n        var mergedConversations = [newConversation].concat(_toConsumableArray(oldConversations));\n        return {\n          getConversations: mergedConversations\n        };\n      }\n    });\n    return function () {\n      unsubscribe();\n    };\n  }, [subscribeToMore]);\n  return React.createElement(Root, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }, React.createElement(HeadingContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, React.createElement(Heading, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177\n    },\n    __self: this\n  }, \"Chats\"), React.createElement(NewMessage, {\n    exact: true,\n    activeClassName: \"selected\",\n    to: generatePath(Routes.MESSAGES, {\n      userId: Routes.NEW_ID_VALUE\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }, React.createElement(PencilIcon, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184\n    },\n    __self: this\n  }))), React.createElement(SearchContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, React.createElement(Search, {\n    location: location,\n    backgroundColor: \"white\",\n    forMessage: true,\n    placeholder: \"Search message\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  })), loading && React.createElement(LoadingDots, {\n    top: \"xl\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197\n    },\n    __self: this\n  }), !loading && React.createElement(UserContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }, data.getConversations.map(function (user) {\n    var unseen = !user.lastMessageSender && !user.seen;\n    return React.createElement(User, {\n      key: user.id,\n      activeClassName: \"selected\",\n      to: \"/messages/\".concat(user.id),\n      seen: unseen ? 0 : 1,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    }, React.createElement(Avatar, {\n      image: user.image,\n      size: 50,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    })), React.createElement(Info, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }, React.createElement(FullNameUnSeen, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, React.createElement(FullName, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }, user.fullName), unseen && React.createElement(UnSeen, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219\n      },\n      __self: this\n    })), React.createElement(LastMessage, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    }, user.lastMessageSender && 'You:', \" \", user.lastMessage)));\n  })));\n};\n\nMessagesUsers.propTypes = {\n  location: PropTypes.object.isRequired,\n  authUser: PropTypes.object.isRequired\n};\nexport default withRouter(MessagesUsers);","map":{"version":3,"sources":["/Users/niruhan/MSc/source_code/new/lang-exchange-lk/frontend/src/pages/Messages/MessagesUsers.js"],"names":["React","useEffect","PropTypes","styled","NavLink","generatePath","withRouter","useQuery","GET_CONVERSATIONS","GET_NEW_CONVERSATIONS_SUBSCRIPTION","Search","PencilIcon","LoadingDots","Avatar","Routes","Root","div","p","theme","colors","border","main","screen","lg","HeadingContainer","spacing","xs","Heading","h3","text","primary","NewMessage","grey","SearchContainer","UserContainer","sm","xxs","User","radius","md","seen","light","Info","FullNameUnSeen","font","size","FullName","UnSeen","LastMessage","MessagesUsers","location","authUser","variables","authUserId","id","subscribeToMore","data","loading","unsubscribe","document","updateQuery","prev","subscriptionData","newConversation","oldConversations","getConversations","some","u","conversations","mergedConversations","MESSAGES","userId","NEW_ID_VALUE","map","user","unseen","lastMessageSender","image","fullName","lastMessage","propTypes","object","isRequired"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport { NavLink, generatePath, withRouter } from 'react-router-dom';\nimport { useQuery } from '@apollo/react-hooks';\n\nimport { GET_CONVERSATIONS } from 'graphql/user';\nimport { GET_NEW_CONVERSATIONS_SUBSCRIPTION } from 'graphql/messages';\n\nimport Search from 'components/Search';\nimport { PencilIcon } from 'components/icons';\nimport { LoadingDots } from 'components/Loading';\nimport Avatar from 'components/Avatar';\n\nimport * as Routes from 'routes';\n\nconst Root = styled.div`\n  width: 80px;\n  height: 100%;\n  border-right: 1px solid ${p => p.theme.colors.border.main};\n\n  @media (min-width: ${p => p.theme.screen.lg}) {\n    width: 330px;\n  }\n`;\n\nconst HeadingContainer = styled.div`\n  border-bottom: 1px solid ${p => p.theme.colors.border.main};\n  height: 60px;\n  padding: 0 ${p => p.theme.spacing.xs};\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n\n  @media (min-width: ${p => p.theme.screen.lg}) {\n    justify-content: space-between;\n  }\n`;\n\nconst Heading = styled.h3`\n  display: none;\n  color: ${p => p.theme.colors.text.primary};\n  margin: 0;\n\n  @media (min-width: ${p => p.theme.screen.lg}) {\n    display: block;\n  }\n`;\n\nconst NewMessage = styled(NavLink)`\n  width: 40px;\n  height: 40px;\n  background-color: ${p => p.theme.colors.grey[200]};\n  border-radius: 50%;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n`;\n\nconst SearchContainer = styled.div`\n  display: none;\n  border-bottom: 1px solid ${p => p.theme.colors.border.main};\n\n  @media (min-width: ${p => p.theme.screen.lg}) {\n    display: block;\n  }\n`;\n\nconst UserContainer = styled.div`\n  margin-top: ${p => p.theme.spacing.sm};\n  padding: 0 ${p => p.theme.spacing.xxs};\n`;\n\nconst User = styled(NavLink)`\n  width: 100%;\n  padding: ${p => p.theme.spacing.xxs} ${p => p.theme.spacing.xxs};\n  margin-bottom: ${p => p.theme.spacing.xxs};\n  border-radius: ${p => p.theme.radius.md};\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  align-items: center;\n  text-decoration: none;\n  color: ${p => p.theme.colors.text.primary};\n\n  @media (max-width: ${p => p.theme.screen.lg}) {\n    ${p =>\n      !p.seen &&\n      `\n        background-color: ${p.theme.colors.primary.light};\n      `};\n  }\n\n  &.selected {\n    background-color: ${p => p.theme.colors.grey[100]};\n  }\n`;\n\nconst Info = styled.div`\n  width: 100%;\n  display: none;\n  padding: 0 ${p => p.theme.spacing.xs};\n\n  @media (min-width: ${p => p.theme.screen.lg}) {\n    display: block;\n  }\n`;\n\nconst FullNameUnSeen = styled.div`\n  width: 100%;\n  font-size: ${p => p.theme.font.size.sm};\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n`;\n\nconst FullName = styled.div`\n  text-overflow: ellipsis;\n  width: 100%;\n`;\n\nconst UnSeen = styled.div`\n  width: 8px;\n  height: 8px;\n  background-color: ${p => p.theme.colors.primary.light};\n  border-radius: 50%;\n`;\n\nconst LastMessage = styled.div`\n  margin-top: ${p => p.theme.spacing.xxs};\n  font-size: ${p => p.theme.font.size.xxs};\n  color: ${p => p.theme.colors.grey[500]};\n  text-overflow: ellipsis;\n`;\n\n/**\n * Component that renders users, with whom auth user had a chat\n */\nconst MessagesUsers = ({ location, authUser }) => {\n  const { subscribeToMore, data, loading } = useQuery(GET_CONVERSATIONS, {\n    variables: { authUserId: authUser.id },\n  });\n\n  useEffect(() => {\n    const unsubscribe = subscribeToMore({\n      document: GET_NEW_CONVERSATIONS_SUBSCRIPTION,\n      updateQuery: (prev, { subscriptionData }) => {\n        if (!subscriptionData.data) return prev;\n\n        const { newConversation } = subscriptionData.data;\n        const oldConversations = prev.getConversations;\n\n        if (oldConversations.some(u => u.id === newConversation.id)) {\n          return prev;\n        }\n\n        // Merge conversations\n        const conversations = newConversation;\n        delete conversations['receiverId'];\n        const mergedConversations = [newConversation, ...oldConversations];\n\n        return { getConversations: mergedConversations };\n      },\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [subscribeToMore]);\n\n  return (\n    <Root>\n      <HeadingContainer>\n        <Heading>Chats</Heading>\n\n        <NewMessage\n          exact\n          activeClassName=\"selected\"\n          to={generatePath(Routes.MESSAGES, { userId: Routes.NEW_ID_VALUE })}\n        >\n          <PencilIcon />\n        </NewMessage>\n      </HeadingContainer>\n\n      <SearchContainer>\n        <Search\n          location={location}\n          backgroundColor=\"white\"\n          forMessage\n          placeholder=\"Search message\"\n        />\n      </SearchContainer>\n\n      {loading && <LoadingDots top=\"xl\" />}\n\n      {!loading && (\n        <UserContainer>\n          {data.getConversations.map(user => {\n            const unseen = !user.lastMessageSender && !user.seen;\n\n            return (\n              <User\n                key={user.id}\n                activeClassName=\"selected\"\n                to={`/messages/${user.id}`}\n                seen={unseen ? 0 : 1}\n              >\n                <span>\n                  <Avatar image={user.image} size={50} />\n                </span>\n\n                <Info>\n                  <FullNameUnSeen>\n                    <FullName>{user.fullName}</FullName>\n\n                    {unseen && <UnSeen />}\n                  </FullNameUnSeen>\n\n                  <LastMessage>\n                    {user.lastMessageSender && 'You:'} {user.lastMessage}\n                  </LastMessage>\n                </Info>\n              </User>\n            );\n          })}\n        </UserContainer>\n      )}\n    </Root>\n  );\n};\n\nMessagesUsers.propTypes = {\n  location: PropTypes.object.isRequired,\n  authUser: PropTypes.object.isRequired,\n};\n\nexport default withRouter(MessagesUsers);\n"]},"metadata":{},"sourceType":"module"}