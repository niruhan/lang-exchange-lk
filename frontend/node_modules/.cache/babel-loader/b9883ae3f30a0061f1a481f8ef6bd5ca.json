{"ast":null,"code":"import _defineProperty from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/Users/niruhan/MSc/source_code/lang-exchange-lk/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/niruhan/MSc/source_code/lang-exchange-lk/frontend/src/components/Follow.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  height: 27px;\\n  cursor: pointer;\\n  outline: none;\\n  font-size: \", \";\\n  font-weight: \", \";\\n  transition: background-color 0.2s, border-color 0.1s;\\n  border-radius: \", \";\\n  color: \", \";\\n  padding: \", \" \", \";\\n  border: \", \";\\n  background-color: \", \";\\n\\n  &:hover {\\n    border-color: \", \";\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Mutation } from 'react-apollo';\nimport styled from 'styled-components';\nimport { GET_FOLLOWED_POSTS, GET_POSTS } from 'graphql/post';\nimport { GET_AUTH_USER, GET_USER } from 'graphql/user';\nimport { CREATE_FOLLOW, DELETE_FOLLOW } from 'graphql/follow';\nimport { NotificationType } from 'constants/NotificationType';\nimport { HOME_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\nimport { useStore } from 'store';\nimport { useNotifications } from 'hooks/useNotifications';\nvar Button = styled.button(_templateObject(), function (p) {\n  return p.theme.font.size.xxs;\n}, function (p) {\n  return p.theme.font.weight.bold;\n}, function (p) {\n  return p.theme.radius.sm;\n}, function (p) {\n  return !p.isFollowing && p.theme.colors.white;\n}, function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.isFollowing ? \"1px solid \".concat(p.theme.colors.border.main) : '0';\n}, function (p) {\n  return p.isFollowing ? 'transparent' : p.theme.colors.primary.main;\n}, function (p) {\n  return p.theme.colors.border.dark;\n});\n/**\n * Component for rendering follow button\n */\n\nvar Follow = function Follow(_ref) {\n  var user = _ref.user;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useStore = useStore(),\n      _useStore2 = _slicedToArray(_useStore, 1),\n      auth = _useStore2[0].auth;\n\n  var notification = useNotifications();\n  var isFollowing = auth.user.following.find(function (f) {\n    return f.user === user.id;\n  });\n\n  var handleClickFollow =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(mutate) {\n      var _ref3, data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n              _context.next = 3;\n              return mutate();\n\n            case 3:\n              _ref3 = _context.sent;\n              data = _ref3.data;\n\n              if (!(auth.user.id === user.id)) {\n                _context.next = 7;\n                break;\n              }\n\n              return _context.abrupt(\"return\", setLoading(false));\n\n            case 7:\n              _context.next = 9;\n              return notification.toggle({\n                user: user,\n                hasDone: isFollowing,\n                notificationType: NotificationType.FOLLOW,\n                notificationTypeId: data.createFollow ? data.createFollow.id : null\n              });\n\n            case 9:\n              setLoading(false);\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleClickFollow(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(); // Detect which mutation to use\n\n\n  var operation = isFollowing ? 'delete' : 'create';\n  var options = {\n    create: {\n      mutation: CREATE_FOLLOW,\n      variables: {\n        userId: user.id,\n        followerId: auth.user.id\n      }\n    },\n    delete: {\n      mutation: DELETE_FOLLOW,\n      variables: {\n        id: isFollowing ? isFollowing.id : null\n      }\n    }\n  };\n  return React.createElement(Mutation, {\n    mutation: options[operation].mutation,\n    variables: {\n      input: _objectSpread({}, options[operation].variables)\n    },\n    refetchQueries: function refetchQueries() {\n      return [{\n        query: GET_AUTH_USER\n      }, {\n        query: GET_POSTS,\n        variables: {\n          authUserId: auth.user.id\n        }\n      }, {\n        query: GET_FOLLOWED_POSTS,\n        variables: {\n          userId: auth.user.id,\n          skip: 0,\n          limit: HOME_PAGE_POSTS_LIMIT\n        }\n      }, {\n        query: GET_USER,\n        variables: {\n          username: user.username\n        }\n      }];\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }, function (mutate) {\n    return React.createElement(Button, {\n      onClick: function onClick() {\n        return handleClickFollow(mutate);\n      },\n      disabled: loading,\n      isFollowing: isFollowing,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }, isFollowing ? 'Following' : 'Follow');\n  });\n};\n\nFollow.propTypes = {\n  user: PropTypes.object.isRequired\n};\nexport default Follow;","map":{"version":3,"sources":["/Users/niruhan/MSc/source_code/lang-exchange-lk/frontend/src/components/Follow.js"],"names":["React","useState","PropTypes","Mutation","styled","GET_FOLLOWED_POSTS","GET_POSTS","GET_AUTH_USER","GET_USER","CREATE_FOLLOW","DELETE_FOLLOW","NotificationType","HOME_PAGE_POSTS_LIMIT","useStore","useNotifications","Button","button","p","theme","font","size","xxs","weight","bold","radius","sm","isFollowing","colors","white","spacing","xs","border","main","primary","dark","Follow","user","loading","setLoading","auth","notification","following","find","f","id","handleClickFollow","mutate","data","toggle","hasDone","notificationType","FOLLOW","notificationTypeId","createFollow","operation","options","create","mutation","variables","userId","followerId","delete","input","query","authUserId","skip","limit","username","propTypes","object","isRequired"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,QAAgC,OAAhC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,QAAT,QAAyB,cAAzB;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AAEA,SAASC,kBAAT,EAA6BC,SAA7B,QAA8C,cAA9C;AACA,SAASC,aAAT,EAAwBC,QAAxB,QAAwC,cAAxC;AACA,SAASC,aAAT,EAAwBC,aAAxB,QAA6C,gBAA7C;AAEA,SAASC,gBAAT,QAAiC,4BAAjC;AACA,SAASC,qBAAT,QAAsC,qBAAtC;AAEA,SAASC,QAAT,QAAyB,OAAzB;AAEA,SAASC,gBAAT,QAAiC,wBAAjC;AAEA,IAAMC,MAAM,GAAGX,MAAM,CAACY,MAAV,oBAIG,UAAAC,CAAC;AAAA,SAAIA,CAAC,CAACC,KAAF,CAAQC,IAAR,CAAaC,IAAb,CAAkBC,GAAtB;AAAA,CAJJ,EAKK,UAAAJ,CAAC;AAAA,SAAIA,CAAC,CAACC,KAAF,CAAQC,IAAR,CAAaG,MAAb,CAAoBC,IAAxB;AAAA,CALN,EAOO,UAAAN,CAAC;AAAA,SAAIA,CAAC,CAACC,KAAF,CAAQM,MAAR,CAAeC,EAAnB;AAAA,CAPR,EAQD,UAAAR,CAAC;AAAA,SAAI,CAACA,CAAC,CAACS,WAAH,IAAkBT,CAAC,CAACC,KAAF,CAAQS,MAAR,CAAeC,KAArC;AAAA,CARA,EASC,UAAAX,CAAC;AAAA,SAAIA,CAAC,CAACC,KAAF,CAAQW,OAAR,CAAgBR,GAApB;AAAA,CATF,EAS6B,UAAAJ,CAAC;AAAA,SAAIA,CAAC,CAACC,KAAF,CAAQW,OAAR,CAAgBC,EAApB;AAAA,CAT9B,EAUA,UAAAb,CAAC;AAAA,SACTA,CAAC,CAACS,WAAF,uBAA6BT,CAAC,CAACC,KAAF,CAAQS,MAAR,CAAeI,MAAf,CAAsBC,IAAnD,IAA4D,GADnD;AAAA,CAVD,EAYU,UAAAf,CAAC;AAAA,SACnBA,CAAC,CAACS,WAAF,GAAgB,aAAhB,GAAgCT,CAAC,CAACC,KAAF,CAAQS,MAAR,CAAeM,OAAf,CAAuBD,IADpC;AAAA,CAZX,EAgBQ,UAAAf,CAAC;AAAA,SAAIA,CAAC,CAACC,KAAF,CAAQS,MAAR,CAAeI,MAAf,CAAsBG,IAA1B;AAAA,CAhBT,CAAZ;AAoBA;;;;AAGA,IAAMC,MAAM,GAAG,SAATA,MAAS,OAAc;AAAA,MAAXC,IAAW,QAAXA,IAAW;;AAAA,kBACGnC,QAAQ,CAAC,KAAD,CADX;AAAA;AAAA,MACpBoC,OADoB;AAAA,MACXC,UADW;;AAAA,kBAERzB,QAAQ,EAFA;AAAA;AAAA,MAElB0B,IAFkB,iBAElBA,IAFkB;;AAG3B,MAAMC,YAAY,GAAG1B,gBAAgB,EAArC;AACA,MAAMY,WAAW,GAAGa,IAAI,CAACH,IAAL,CAAUK,SAAV,CAAoBC,IAApB,CAAyB,UAAAC,CAAC;AAAA,WAAIA,CAAC,CAACP,IAAF,KAAWA,IAAI,CAACQ,EAApB;AAAA,GAA1B,CAApB;;AAEA,MAAMC,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAG,iBAAMC,MAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AACxBR,cAAAA,UAAU,CAAC,IAAD,CAAV;AADwB;AAAA,qBAEDQ,MAAM,EAFL;;AAAA;AAAA;AAEhBC,cAAAA,IAFgB,SAEhBA,IAFgB;;AAAA,oBAKpBR,IAAI,CAACH,IAAL,CAAUQ,EAAV,KAAiBR,IAAI,CAACQ,EALF;AAAA;AAAA;AAAA;;AAAA,+CAKaN,UAAU,CAAC,KAAD,CALvB;;AAAA;AAAA;AAAA,qBAMlBE,YAAY,CAACQ,MAAb,CAAoB;AACxBZ,gBAAAA,IAAI,EAAJA,IADwB;AAExBa,gBAAAA,OAAO,EAAEvB,WAFe;AAGxBwB,gBAAAA,gBAAgB,EAAEvC,gBAAgB,CAACwC,MAHX;AAIxBC,gBAAAA,kBAAkB,EAAEL,IAAI,CAACM,YAAL,GAAoBN,IAAI,CAACM,YAAL,CAAkBT,EAAtC,GAA2C;AAJvC,eAApB,CANkB;;AAAA;AAYxBN,cAAAA,UAAU,CAAC,KAAD,CAAV;;AAZwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAjBO,iBAAiB;AAAA;AAAA;AAAA,KAAvB,CAN2B,CAqB3B;;;AACA,MAAMS,SAAS,GAAG5B,WAAW,GAAG,QAAH,GAAc,QAA3C;AACA,MAAM6B,OAAO,GAAG;AACdC,IAAAA,MAAM,EAAE;AACNC,MAAAA,QAAQ,EAAEhD,aADJ;AAENiD,MAAAA,SAAS,EAAE;AAAEC,QAAAA,MAAM,EAAEvB,IAAI,CAACQ,EAAf;AAAmBgB,QAAAA,UAAU,EAAErB,IAAI,CAACH,IAAL,CAAUQ;AAAzC;AAFL,KADM;AAKdiB,IAAAA,MAAM,EAAE;AACNJ,MAAAA,QAAQ,EAAE/C,aADJ;AAENgD,MAAAA,SAAS,EAAE;AAAEd,QAAAA,EAAE,EAAElB,WAAW,GAAGA,WAAW,CAACkB,EAAf,GAAoB;AAArC;AAFL;AALM,GAAhB;AAWA,SACE,oBAAC,QAAD;AACE,IAAA,QAAQ,EAAEW,OAAO,CAACD,SAAD,CAAP,CAAmBG,QAD/B;AAEE,IAAA,SAAS,EAAE;AAAEK,MAAAA,KAAK,oBAAOP,OAAO,CAACD,SAAD,CAAP,CAAmBI,SAA1B;AAAP,KAFb;AAGE,IAAA,cAAc,EAAE;AAAA,aAAM,CACpB;AAAEK,QAAAA,KAAK,EAAExD;AAAT,OADoB,EAEpB;AAAEwD,QAAAA,KAAK,EAAEzD,SAAT;AAAoBoD,QAAAA,SAAS,EAAE;AAAEM,UAAAA,UAAU,EAAEzB,IAAI,CAACH,IAAL,CAAUQ;AAAxB;AAA/B,OAFoB,EAGpB;AACEmB,QAAAA,KAAK,EAAE1D,kBADT;AAEEqD,QAAAA,SAAS,EAAE;AACTC,UAAAA,MAAM,EAAEpB,IAAI,CAACH,IAAL,CAAUQ,EADT;AAETqB,UAAAA,IAAI,EAAE,CAFG;AAGTC,UAAAA,KAAK,EAAEtD;AAHE;AAFb,OAHoB,EAWpB;AAAEmD,QAAAA,KAAK,EAAEvD,QAAT;AAAmBkD,QAAAA,SAAS,EAAE;AAAES,UAAAA,QAAQ,EAAE/B,IAAI,CAAC+B;AAAjB;AAA9B,OAXoB,CAAN;AAAA,KAHlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAiBG,UAAArB,MAAM,EAAI;AACT,WACE,oBAAC,MAAD;AACE,MAAA,OAAO,EAAE;AAAA,eAAMD,iBAAiB,CAACC,MAAD,CAAvB;AAAA,OADX;AAEE,MAAA,QAAQ,EAAET,OAFZ;AAGE,MAAA,WAAW,EAAEX,WAHf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKGA,WAAW,GAAG,WAAH,GAAiB,QAL/B,CADF;AASD,GA3BH,CADF;AA+BD,CAjED;;AAmEAS,MAAM,CAACiC,SAAP,GAAmB;AACjBhC,EAAAA,IAAI,EAAElC,SAAS,CAACmE,MAAV,CAAiBC;AADN,CAAnB;AAIA,eAAenC,MAAf","sourcesContent":["import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Mutation } from 'react-apollo';\nimport styled from 'styled-components';\n\nimport { GET_FOLLOWED_POSTS, GET_POSTS } from 'graphql/post';\nimport { GET_AUTH_USER, GET_USER } from 'graphql/user';\nimport { CREATE_FOLLOW, DELETE_FOLLOW } from 'graphql/follow';\n\nimport { NotificationType } from 'constants/NotificationType';\nimport { HOME_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\n\nimport { useStore } from 'store';\n\nimport { useNotifications } from 'hooks/useNotifications';\n\nconst Button = styled.button`\n  height: 27px;\n  cursor: pointer;\n  outline: none;\n  font-size: ${p => p.theme.font.size.xxs};\n  font-weight: ${p => p.theme.font.weight.bold};\n  transition: background-color 0.2s, border-color 0.1s;\n  border-radius: ${p => p.theme.radius.sm};\n  color: ${p => !p.isFollowing && p.theme.colors.white};\n  padding: ${p => p.theme.spacing.xxs} ${p => p.theme.spacing.xs};\n  border: ${p =>\n    p.isFollowing ? `1px solid ${p.theme.colors.border.main}` : '0'};\n  background-color: ${p =>\n    p.isFollowing ? 'transparent' : p.theme.colors.primary.main};\n\n  &:hover {\n    border-color: ${p => p.theme.colors.border.dark};\n  }\n`;\n\n/**\n * Component for rendering follow button\n */\nconst Follow = ({ user }) => {\n  const [loading, setLoading] = useState(false);\n  const [{ auth }] = useStore();\n  const notification = useNotifications();\n  const isFollowing = auth.user.following.find(f => f.user === user.id);\n\n  const handleClickFollow = async mutate => {\n    setLoading(true);\n    const { data } = await mutate();\n\n    // Create or Delete mutation for follow\n    if (auth.user.id === user.id) return setLoading(false);\n    await notification.toggle({\n      user,\n      hasDone: isFollowing,\n      notificationType: NotificationType.FOLLOW,\n      notificationTypeId: data.createFollow ? data.createFollow.id : null,\n    });\n    setLoading(false);\n  };\n\n  // Detect which mutation to use\n  const operation = isFollowing ? 'delete' : 'create';\n  const options = {\n    create: {\n      mutation: CREATE_FOLLOW,\n      variables: { userId: user.id, followerId: auth.user.id },\n    },\n    delete: {\n      mutation: DELETE_FOLLOW,\n      variables: { id: isFollowing ? isFollowing.id : null },\n    },\n  };\n\n  return (\n    <Mutation\n      mutation={options[operation].mutation}\n      variables={{ input: { ...options[operation].variables } }}\n      refetchQueries={() => [\n        { query: GET_AUTH_USER },\n        { query: GET_POSTS, variables: { authUserId: auth.user.id } },\n        {\n          query: GET_FOLLOWED_POSTS,\n          variables: {\n            userId: auth.user.id,\n            skip: 0,\n            limit: HOME_PAGE_POSTS_LIMIT,\n          },\n        },\n        { query: GET_USER, variables: { username: user.username } },\n      ]}\n    >\n      {mutate => {\n        return (\n          <Button\n            onClick={() => handleClickFollow(mutate)}\n            disabled={loading}\n            isFollowing={isFollowing}\n          >\n            {isFollowing ? 'Following' : 'Follow'}\n          </Button>\n        );\n      }}\n    </Mutation>\n  );\n};\n\nFollow.propTypes = {\n  user: PropTypes.object.isRequired,\n};\n\nexport default Follow;\n"]},"metadata":{},"sourceType":"module"}